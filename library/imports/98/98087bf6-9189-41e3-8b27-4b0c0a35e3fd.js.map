{"version":3,"sources":["assets/Scripts/StepViewItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport ConstValue from \"./ConstValue\";\nimport EventListener from \"./event_listener\";\n\n@ccclass\nexport default class StepViewItem extends cc.Component {\n\n    @property(cc.Sprite)\n    m_sp_stepicon: cc.Sprite = null;\n\n    @property(cc.Sprite)\n    m_sp_stepname: cc.Sprite = null;\n\n    @property([cc.Node])\n    m_n_starlist: cc.Node[] = [];\n\n    @property(cc.Node)\n    m_n_bg: cc.Node = null;\n\n    @property(cc.Label)\n    m_l_steptitle: cc.Label = null;\n\n    @property(cc.SpriteAtlas)\n    m_spa_list: cc.SpriteAtlas = null;\n\n    private _callback: Function = null;\n    private _stepname: string = \"\";\n    private _onshowback: boolean = false;\n\n    start(): void {\n        EventListener.instance.on(window.ON_SHOW_BACK, this.onshowback, this);\n    }\n\n    onDestroy(): void {\n        EventListener.instance.off(window.ON_SHOW_BACK, this);\n    }\n\n    setCloseCallback(callback: Function): void {\n        this._callback = callback;\n    }\n\n    onClose(): void {\n        this._callback && this._callback();\n        this.node.active = false;\n    }\n\n    onshowback(): void {\n        if (this._onshowback) {\n            this._onshowback = false;\n            this.onClose();\n        }\n    }\n\n    showStep(step: number): void {\n        const starCount = this.updateData(step);\n        \n        for (let i = 0; i < this.m_n_starlist.length; i++) {\n            this.m_n_starlist[i].active = false;\n        }\n\n        this.m_sp_stepicon.node.getComponent(cc.Animation).play(\"playstep\");\n        this.m_sp_stepname.node.getComponent(cc.Animation).play(\"playstep\");\n\n        this.scheduleOnce(() => {\n            Common_CommonUtil.default.shakeScreen(this.m_n_bg);\n        }, 0.4);\n\n        const showStar = (index: number) => {\n            this.m_n_starlist[index].active = true;\n            this.m_n_starlist[index].scale = 0;\n            this.scheduleOnce(() => {\n                this.m_n_starlist[index].runAction(\n                    cc.sequence(\n                        cc.scaleTo(0.2, 1.4, 1.4).easing(cc.easeIn(3)),\n                        cc.scaleTo(0.1, 1, 1)\n                    )\n                );\n                Utils3.SetSoundEffect(window.GET_GOLD, false, 1);\n            }, 0.54 + 0.3 * (index + 1));\n        };\n\n        for (let i = 0; i < starCount; i++) {\n            showStar(i);\n        }\n    }\n\n    updateData(step: number = 0): number {\n        const level = Math.floor(step / 10);\n        const stepConfig = ConstValue.STEP_CONFIG[level - 1];\n        let starCount = 0;\n\n        if (stepConfig) {\n            starCount = stepConfig.star;\n            this._stepname = stepConfig.desc;\n            this.m_l_steptitle.string = cc.js.formatStr(\"完成%d关 段位提升\", step);\n            this.m_sp_stepicon.spriteFrame = this.m_spa_list.getSpriteFrame(stepConfig.icon_path);\n            this.m_sp_stepname.spriteFrame = this.m_spa_list.getSpriteFrame(stepConfig.desc_path);\n        }\n\n        return starCount;\n    }\n\n    setShowBtnVisible(visible: boolean): void {\n        for (let i = 0; i < this.m_n_starlist.length; i++) {\n            this.m_n_starlist[i].active = visible;\n        }\n        this.m_sp_stepicon.node.active = visible;\n        this.m_sp_stepname.node.active = visible;\n    }\n\n    onShareStep(): void {\n        this._onshowback = true;\n        ShareSdk.shareAppMessage({\n            title: `消除段位升级到【${this._stepname}】,一起来见证吧`,\n            imageUrl: window.tempFileURL[1]\n        });\n    }\n}"]}