{"version":3,"sources":["assets/Scripts/Common.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAC5C,+CAA0C;AAC1C,uCAAoE;AACpE,uCAAsC;AACtC,mCAAyB;AACzB,yCAAsC;AACtC,+CAAuD;AACvD,iCAA4B;AAE5B;IAAoC,0BAAY;IAAhD;;IA2JA,CAAC;eA3JoB,MAAM;IAGvB,sBAAkB,kBAAQ;aAA1B;YACI,OAAO,IAAI,CAAC,SAAS,CAAC;QAC1B,CAAC;;;OAAA;IAED,uBAAM,GAAN;QACI,IAAI,QAAM,CAAC,SAAS,KAAK,IAAI,EAAE;YAC3B,QAAM,CAAC,SAAS,GAAG,IAAI,CAAC;SAC3B;IACL,CAAC;IAED,6BAAY,GAAZ;QACI,IAAM,SAAS,GAAG,mBAAQ,CAAC,YAAY,CAAC,mBAAQ,CAAC,CAAC;QAClD,IAAM,YAAY,GAAG,mBAAQ,CAAC,YAAY,CAAC,OAAO,CAAC,cAAc,CAAC;QAClE,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,SAAS,EAAE,MAAM,EAAE,YAAY,CAAC,CAAC;QACtD,IAAI,YAAY,GAAG,SAAS,EAAE;YAC1B,mBAAQ,CAAC,YAAY,CAAC,mBAAQ,EAAE,YAAY,CAAC,CAAC;SACjD;IACL,CAAC;IAED,uBAAM,GAAN;QACI,IAAM,SAAS,GAAG,OAAO,GAAG,mBAAQ,CAAC;QACrC,mBAAQ,CAAC,WAAW,EAAE,CAAC;QACvB,IAAI,mBAAQ,CAAC,SAAS,KAAK,CAAC,EAAE;YAC1B,mBAAQ,CAAC,SAAS,GAAG,CAAC,CAAC;YACvB,mBAAQ,CAAC,SAAS,GAAG,SAAS,CAAC;YAC/B,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;SACzC;aAAM;YACH,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;SACpC;IACL,CAAC;IAED,uBAAM,GAAN;QACI,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IAClC,CAAC;IAED,gCAAe,GAAf;QACI,IAAI,CAAC,SAAS,CAAC,mBAAQ,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;IACrD,CAAC;IAED,kCAAiB,GAAjB;QACI,IAAI,CAAC,SAAS,CAAC,mBAAQ,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;IACzD,CAAC;IAED,sCAAqB,GAArB;QACI,IAAI,CAAC,SAAS,CAAC,mBAAQ,CAAC,YAAY,CAAC,kBAAkB,CAAC,CAAC;IAC7D,CAAC;IAED,iCAAgB,GAAhB;QACI,IAAI,CAAC,SAAS,CAAC,uBAAY,CAAC,YAAY,CAAC,CAAC;IAC9C,CAAC;IAED,kCAAiB,GAAjB;QACI,IAAI,CAAC,SAAS,CAAC,uBAAY,CAAC,aAAa,CAAC,CAAC;IAC/C,CAAC;IAED,8BAAa,GAAb,UAAc,KAAc,EAAE,IAAY,EAAE,QAAmB;QAC3D,IAAI,IAAI,KAAK,CAAC,EAAE;YACZ,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;SACxB;QAED,IAAM,UAAU,GAAG,EAAE,CAAC,WAAW,CAAC,uBAAY,CAAC,QAAQ,CAAC,CAAC;QACzD,UAAU,CAAC,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QACtD,UAAU,CAAC,QAAQ,GAAG,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;QAE9C,IAAM,YAAY,GAAG,IAAI,GAAG,UAAU,CAAC;QACvC,IAAM,eAAe,GAAG,UAAU,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC,YAAY,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;QAC1G,eAAe,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QAEnC,IAAM,WAAW,GAAG,gBAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACnC,IAAM,cAAc,GAAG;YACnB,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,CAAC;YAC/B,CAAC,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,CAAC;YACnC,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,CAAC;SAClC,CAAC;QACF,IAAM,aAAa,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC,WAAW,CAAC,CAAC;QAExD,eAAK,CAAC,WAAW,CAAC,eAAe,EAAE,aAAa,EAAE;YAC9C,IAAI,QAAQ,EAAE;gBACV,QAAQ,EAAE,CAAC;aACd;YACD,UAAU,CAAC,OAAO,EAAE,CAAC;QACzB,CAAC,CAAC,CAAC;IACP,CAAC;IAED,6BAAY,GAAZ;QACI,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAO,CAAC,QAAQ,CAAC,CAAC;QAClD,IAAI,CAAC,SAAS,CAAC,uBAAY,CAAC,QAAQ,CAAC,CAAC;IAC1C,CAAC;IAED,iCAAgB,GAAhB;QACI,IAAM,OAAO,GAAG,SAAS,CAAC,OAAO,IAAI,mBAAO,CAAC,EAAE,CAAC,CAAC,CAAC,sBAAO,CAAC,cAAc,CAAC,CAAC,CAAC,sBAAO,CAAC,YAAY,CAAC;QAChG,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QACzC,IAAI,CAAC,SAAS,CAAC,uBAAY,CAAC,YAAY,CAAC,CAAC;IAC9C,CAAC;IAED,+BAAc,GAAd;QACI,mBAAQ,CAAC,WAAW,GAAG,KAAK,CAAC;QAC7B,IAAI,CAAC,YAAY,CAAC;YACd,mBAAQ,CAAC,WAAW,GAAG,IAAI,CAAC;QAChC,CAAC,EAAE,mBAAQ,CAAC,eAAe,CAAC,CAAC;IACjC,CAAC;IAED,gCAAe,GAAf,UAAgB,OAAgB,EAAE,UAAe,EAAE,QAAmB;QAClE,IAAI,mBAAQ,IAAI,eAAI,CAAC,KAAK,IAAI,mBAAQ,IAAI,eAAI,CAAC,KAAK,IAAI,mBAAQ,CAAC,eAAe,GAAG,CAAC,EAAE;YAClF,OAAO;SACV;QAED,IAAI,CAAC,OAAO,EAAE;YACV,IAAI,mBAAQ,CAAC,MAAM;gBAAE,OAAO;YAC5B,IAAI,CAAC,mBAAQ,CAAC,WAAW;gBAAE,OAAO;SACrC;QAED,mBAAQ,CAAC,KAAK,EAAE,CAAC;QACjB,mBAAQ,CAAC,eAAe,EAAE,CAAC;QAE3B,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,oBAAoB,EAAE,EAAE,CAAC,MAAM,EAAE,UAAC,GAAG,EAAE,MAAM;YAC3D,IAAI,GAAG,EAAE;gBACL,OAAO,CAAC,KAAK,CAAC,QAAQ,EAAE,eAAe,GAAG,GAAG,CAAC,CAAC;gBAC/C,OAAO;aACV;YAED,IAAI,CAAC,CAAC,MAAM,YAAY,EAAE,CAAC,MAAM,CAAC,EAAE;gBAChC,OAAO,CAAC,KAAK,CAAC,QAAQ,EAAE,aAAa,CAAC,CAAC;gBACvC,OAAO;aACV;YAED,IAAM,cAAc,GAAG,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YAC9C,cAAc,CAAC,IAAI,GAAG,YAAY,CAAC;YACnC,cAAc,CAAC,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAE1C,IAAM,MAAM,GAAG,cAAc,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC;YACzD,IAAI,MAAM,EAAE;gBACR,MAAM,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;aACxC;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED,6BAAY,GAAZ;QACI,MAAM;IACV,CAAC;IAED,0BAAS,GAAT,UAAU,MAAiB,EAAE,IAAU;QACnC,IAAM,IAAI,GAAG,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QACpC,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAEhC,IAAI,IAAI,EAAE;YACN,IAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC;YAC/C,IAAI,MAAM,EAAE;gBACR,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;aACxB;SACJ;IACL,CAAC;;IAzJc,gBAAS,GAAW,IAAI,QAAM,EAAE,CAAC;IAD/B,MAAM;QAD1B,OAAO;OACa,MAAM,CA2J1B;IAAD,aAAC;CA3JD,AA2JC,CA3JmC,EAAE,CAAC,SAAS,GA2J/C;kBA3JoB,MAAM","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport ExtendScript from \"./ExtendScript\";\nimport { MODE, GameMode, CommonPrefab, Property } from \"./Property\";\nimport { GameData } from \"./GameData\";\nimport _ from \"./lodash\";\nimport { CHANNEL } from \"./PlatformA\";\nimport AudioManager, { AudioID } from \"./AudioManager\";\nimport Utils from \"./Utils\";\n@ccclass\nexport default class Common extends cc.Component {\n    private static _instance: Common = new Common();\n    \n    public static get instance(): Common {\n        return this._instance;\n    }\n\n    onLoad() {\n        if (Common._instance === null) {\n            Common._instance = this;\n        }\n    }\n\n    setBestScore(): void {\n        const bestScore = GameData.getBestScore(GameMode);\n        const currentScore = GameData.gameDataBind.fkScore._showBestScore;\n        console.log(\"存档最高分\", bestScore, \"当前得分\", currentScore);\n        if (currentScore > bestScore) {\n            GameData.setBestScore(GameMode, currentScore);\n        }\n    }\n\n    toGame(): void {\n        const sceneName = \"game_\" + GameMode;\n        GameData.initialData();\n        if (GameData.oneToGame === 0) {\n            GameData.oneToGame = 1;\n            GameData.sceneName = sceneName;\n            cc.director.loadScene(\"LoadingScene\");\n        } else {\n            cc.director.loadScene(sceneName);\n        }\n    }\n\n    toMenu(): void {\n        cc.director.loadScene(\"menu\");\n    }\n\n    showRebornLayer(): void {\n        this.addPrefab(GameData.gameDataBind.rebornNode);\n    }\n\n    showEndScoreLayer(): void {\n        this.addPrefab(GameData.gameDataBind.endScorePrefab);\n    }\n\n    showEndBestScoreLayer(): void {\n        this.addPrefab(GameData.gameDataBind.endBestScorePrefab);\n    }\n\n    showGameWinLayer(): void {\n        this.addPrefab(CommonPrefab.endWinPrefab);\n    }\n\n    showGameLoseLayer(): void {\n        this.addPrefab(CommonPrefab.endLosePrefab);\n    }\n\n    showBlockBoom(block: cc.Node, type: number, callback?: Function): void {\n        if (type === 0) {\n            block.active = false;\n        }\n\n        const boomEffect = cc.instantiate(CommonPrefab.iceBlock);\n        boomEffect.parent = cc.find(\"Canvas/uiRoot/tempNode\");\n        boomEffect.position = cc.v2(block.x, block.y);\n\n        const skeletonName = type + \"_xbh_ske\";\n        const armatureDisplay = boomEffect.getChildByName(skeletonName).getComponent(dragonBones.ArmatureDisplay);\n        armatureDisplay.node.active = true;\n\n        const randomIndex = _.random(1, 4);\n        const animationTypes = [\n            [\"hua\", \"hua1\", \"hua2\", \"hua3\"],\n            [\"bing\", \"bing1\", \"bing2\", \"bing3\"], \n            [\"xue\", \"xue1\", \"xue2\", \"xue3\"]\n        ];\n        const animationName = animationTypes[type][randomIndex];\n\n        Utils.playAniCall(armatureDisplay, animationName, () => {\n            if (callback) {\n                callback();\n            }\n            boomEffect.destroy();\n        });\n    }\n\n    showNewScore(): void {\n        AudioManager.instance.playSound(AudioID.NewScore);\n        this.addPrefab(CommonPrefab.newScore);\n    }\n\n    showUnbelievable(): void {\n        const soundID = lplatform.channel == CHANNEL.qq ? AudioID.UnbelievableQQ : AudioID.Unbelievable;\n        AudioManager.instance.playSound(soundID);\n        this.addPrefab(CommonPrefab.unbelievable);\n    }\n\n    pushChangeTime(): void {\n        GameData.canShowPush = false;\n        this.scheduleOnce(() => {\n            GameData.canShowPush = true;\n        }, Property.PUSH_TIME_DELAY);\n    }\n\n    pushChangeBlock(isForce: boolean, changeType: any, callback?: Function): void {\n        if (GameMode == MODE.TEACH || GameMode == MODE.JIEMI || GameData.pushChangeCount > 0) {\n            return;\n        }\n\n        if (!isForce) {\n            if (GameData.isFail) return;\n            if (!GameData.canShowPush) return;\n        }\n\n        GameData.pause();\n        GameData.pushChangeCount++;\n\n        cc.resources.load(\"prefabs/pushChange\", cc.Prefab, (err, prefab) => {\n            if (err) {\n                console.error(\"Common\", \"载入预制资源失败, 原因:\" + err);\n                return;\n            }\n\n            if (!(prefab instanceof cc.Prefab)) {\n                console.error(\"Common\", \"你载入的不是预制资源!\");\n                return;\n            }\n\n            const pushChangeNode = cc.instantiate(prefab);\n            pushChangeNode.name = \"pushChange\";\n            pushChangeNode.parent = cc.find(\"Canvas\");\n            \n            const script = pushChangeNode.getComponent(ExtendScript);\n            if (script) {\n                script.initial(changeType, callback);\n            }\n        });\n    }\n\n    pushZaJinDan(): void {\n        // 空实现\n    }\n\n    addPrefab(prefab: cc.Prefab, data?: any): void {\n        const node = cc.instantiate(prefab);\n        node.parent = cc.find(\"Canvas\");\n        \n        if (data) {\n            const script = node.getComponent(ExtendScript);\n            if (script) {\n                script.initial(data);\n            }\n        }\n    }\n}"]}