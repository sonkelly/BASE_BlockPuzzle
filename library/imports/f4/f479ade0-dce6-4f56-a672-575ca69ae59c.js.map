{"version":3,"sources":["assets/Scripts/Wxlife.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAC5C,mDAA6C;AAC7C,mCAAkC;AAElC;IAAoC,0BAAY;IAAhD;QAAA,qEAoEC;QAjEW,cAAQ,GAAY,KAAK,CAAC;QAC1B,cAAQ,GAAW,CAAC,CAAC;;IAgEjC,CAAC;eApEoB,MAAM;IAMvB,sBAAkB,kBAAQ;aAA1B;YACI,OAAO,IAAI,CAAC,SAAS,CAAC;QAC1B,CAAC;;;OAAA;IAED,uBAAM,GAAN;QACI,IAAI,QAAM,CAAC,SAAS,KAAK,IAAI,EAAE;YAC3B,QAAM,CAAC,SAAS,GAAG,IAAI,CAAC;SAC3B;aAAM;YACH,IAAI,CAAC,OAAO,EAAE,CAAC;YACf,OAAO;SACV;QAED,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;QAE3B,UAAU;QACV,MAAM,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC;QAC3B,MAAM,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC;QAC7B,MAAM,CAAC,SAAS,CAAC,GAAG,KAAK,CAAC;QAC1B,MAAM,CAAC,UAAU,CAAC,GAAG,KAAK,CAAC;QAC3B,MAAM,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC;QAC7B,MAAM,CAAC,UAAU,CAAC,GAAG,IAAI,CAAC;QAE1B,WAAW;QAEX,IAAI,CAAC,YAAY,EAAE,CAAC;IACxB,CAAC;IAEO,6BAAY,GAApB;QAAA,iBA4BC;QA3BG,IAAI,OAAO,EAAE,KAAK,WAAW,EAAE;YAC3B,SAAS;YACT,EAAE,CAAC,MAAM,CAAC;gBACN,KAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;gBAErB,IAAI,MAAM,CAAC,SAAS,CAAC,EAAE;oBACnB,eAAM,CAAC,WAAW,EAAE,CAAC;iBACxB;gBAED,KAAI,CAAC,QAAQ,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;YACzC,CAAC,CAAC,CAAC;YAEH,SAAS;YACT,EAAE,CAAC,MAAM,CAAC,UAAC,GAAQ;gBACf,IAAI,KAAI,CAAC,QAAQ,EAAE;oBACf,eAAM,CAAC,aAAa,EAAE,CAAC;oBAEvB,IAAM,WAAW,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;oBACzC,wBAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,EAAE,WAAW,GAAG,KAAI,CAAC,QAAQ,CAAC,CAAC;iBACpF;gBAED,IAAI,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,CAAC,KAAK,EAAE;oBAC9B,MAAM,CAAC,UAAU,CAAC,GAAG,GAAG,CAAC;oBACzB,wBAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC,CAAC;iBAC7D;YACL,CAAC,CAAC,CAAC;SACN;IACL,CAAC;IAED,0BAAS,GAAT;QACI,IAAI,QAAM,CAAC,SAAS,KAAK,IAAI,EAAE;YAC3B,QAAM,CAAC,SAAS,GAAG,IAAI,CAAC;SAC3B;IACL,CAAC;;IAjEc,gBAAS,GAAW,IAAI,CAAC;IAFvB,MAAM;QAD1B,OAAO;OACa,MAAM,CAoE1B;IAAD,aAAC;CApED,AAoEC,CApEmC,EAAE,CAAC,SAAS,GAoE/C;kBApEoB,MAAM","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport EventListener from \"./event_listener\";\nimport { Utils3 } from \"./Utils3\";\n@ccclass\nexport default class Wxlife extends cc.Component {\n\n    private static _instance: Wxlife = null;\n    private isHidden: boolean = false;\n    private hideTime: number = 0;\n\n    public static get instance(): Wxlife {\n        return this._instance;\n    }\n\n    onLoad() {\n        if (Wxlife._instance === null) {\n            Wxlife._instance = this;\n        } else {\n            this.destroy();\n            return;\n        }\n\n        cc.view.enableRetina(true);\n        \n        // 初始化全局变量\n        window['firstGame'] = true;\n        window['firststart'] = false;\n        window['getdata'] = false;\n        window['need_add'] = false;\n        window['firstshare'] = false;\n        window['SHOW_RES'] = null;\n\n        // 初始化事件监听器\n\n        this.initWxEvents();\n    }\n\n    private initWxEvents(): void {\n        if (typeof wx !== 'undefined') {\n            // 微信隐藏事件\n            wx.onHide(() => {\n                this.isHidden = true;\n                \n                if (window['getdata']) {\n                    Utils3.setSaveData();\n                }\n                \n                this.hideTime = new Date().getTime();\n            });\n\n            // 微信显示事件\n            wx.onShow((res: any) => {\n                if (this.isHidden) {\n                    Utils3.resumBgmMusic();\n                    \n                    const currentTime = new Date().getTime();\n                    EventListener.instance.fire(window['ON_SHOW_BACK'], currentTime - this.hideTime);\n                }\n\n                if (res.query && res.query.group) {\n                    window['SHOW_RES'] = res;\n                    EventListener.instance.fire(window['GAME_RANK_LISTENER']);\n                }\n            });\n        }\n    }\n\n    onDestroy() {\n        if (Wxlife._instance === this) {\n            Wxlife._instance = null;\n        }\n    }\n}"]}