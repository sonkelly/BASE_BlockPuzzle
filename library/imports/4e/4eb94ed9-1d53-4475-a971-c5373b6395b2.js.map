{"version":3,"sources":["assets/Scripts/NewBieGift.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import EventListener from \"./event_listener\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class NewBieGift extends cc.Component {\n    @property(cc.Node)\n    m_n_newpanel: cc.Node = null;\n\n    @property(cc.Node)\n    m_n_newpanel_success: cc.Node = null;\n\n    @property(cc.Button)\n    m_btn_getreward: cc.Button = null;\n\n    @property(cc.Label)\n    m_l_desc: cc.Label = null;\n\n    private _onshowback: boolean = false;\n\n    start(): void {\n        this.m_n_newpanel.active = false;\n        this.m_n_newpanel_success.active = false;\n        EventListener.instance.on(window.ON_SHOW_BACK, this.onshowback, this);\n        this.updateData();\n    }\n\n    onEnable(): void {}\n\n    onDisable(): void {}\n\n    onDestroy(): void {\n        EventListener.instance.off(window.ON_SHOW_BACK, this);\n    }\n\n    private onshowback(): void {\n        if (this._onshowback) {\n            this._onshowback = false;\n            if (this.m_n_newpanel_success.active) {\n                this.m_n_newpanel_success.active = false;\n            }\n        }\n    }\n\n    private autoShowRewardPage(): void {\n        if (this.getState() === 1) {\n            if (!window.firststart) {\n                this.onBtnNewBieClick();\n                window.firststart = true;\n            }\n        }\n    }\n\n    private getState(): number {\n        let state = 1;\n        const loginTime = window.INIT_GAME_SAVE_DATA.login_time;\n        \n        if (loginTime && loginTime !== \"null\" && loginTime !== \"\") {\n            const loginDate = loginTime.split(\"/\");\n            const currentDateInfo = this.getCurrentDate();\n            const currentDate = currentDateInfo[1];\n            state = this.judgeTime(loginDate, currentDate);\n        }\n        \n        return state;\n    }\n\n    private getCurrentDate(): [string, string[]] {\n        const now = new Date();\n        const dateStr = `${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()}`;\n        const dateArr = dateStr.split(\"/\");\n        return [dateStr, dateArr];\n    }\n\n    private judgeTime(loginDate: string[], currentDate: string[]): number {\n        const loginYear = parseInt(loginDate[0]);\n        const currentYear = parseInt(currentDate[0]);\n        \n        if (loginYear < currentYear) return 1;\n        if (loginYear > currentYear) return -1;\n        \n        const loginMonth = parseInt(loginDate[1]);\n        const currentMonth = parseInt(currentDate[1]);\n        \n        if (loginMonth < currentMonth) return 1;\n        if (loginMonth > currentMonth) return -1;\n        \n        const loginDay = parseInt(loginDate[2]);\n        const currentDay = parseInt(currentDate[2]);\n        \n        let result = 0;\n        if (loginDay < currentDay) {\n            result = 1;\n        } else if (loginDay > currentDay) {\n            result = -1;\n        }\n        \n        return result;\n    }\n\n    private updateData(): void {\n        this.autoShowRewardPage();\n        \n        if (this.getState() === 1) {\n            this.m_btn_getreward.interactable = true;\n            this.m_l_desc.string = \"每天可领一次\";\n        } else {\n            this.m_btn_getreward.interactable = false;\n            const btnLabel = this.m_btn_getreward.node.getComponent(cc.Label);\n            if (btnLabel) {\n                btnLabel.string = \"明天再来吧~\";\n            }\n            this.m_l_desc.string = \"每天可领一次(已领取)\";\n        }\n    }\n\n    private onBtnNewBieClick(): void {\n        const Utils3 = cc.js.getClassByName(\"Utils3\");\n        Utils3.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        \n        this.m_n_newpanel.active = true;\n        \n        if (this.getState() === 1) {\n            this.m_btn_getreward.interactable = true;\n            this.m_l_desc.string = \"每天可领一次\";\n        } else {\n            this.m_btn_getreward.interactable = false;\n            const btnLabel = this.m_btn_getreward.node.getComponent(cc.Label);\n            if (btnLabel) {\n                btnLabel.string = \"明天再来吧~\";\n            }\n            this.m_l_desc.string = \"每天可领一次(已领取)\";\n        }\n    }\n\n    private onBackBtnClick(): void {\n        const Utils3 = cc.js.getClassByName(\"Utils3\");\n        Utils3.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        \n        this.m_n_newpanel.active = false;\n        this.m_n_newpanel_success.active = false;\n    }\n\n    private onRewardBackBtnClick(): void {\n        const Utils3 = cc.js.getClassByName(\"Utils3\");\n        Utils3.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        \n        this.m_n_newpanel.active = false;\n        this.m_n_newpanel_success.active = false;\n    }\n\n    private onBtnGetRewardClick(): void {\n        const Utils3 = cc.js.getClassByName(\"Utils3\");\n        Utils3.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        \n        this.m_n_newpanel.active = false;\n        this.m_n_newpanel_success.active = true;\n        \n        const currentDate = this.getCurrentDate()[0];\n        this._onshowback = true;\n        \n        window.INIT_GAME_SAVE_DATA.login_time = currentDate;\n        window.INIT_GAME_SAVE_DATA.tool[0] += 1;\n        window.INIT_GAME_SAVE_DATA.gold_num += 10;\n        \n        this.updateData();\n        \n        if (window.GAME_MENU) {\n            window.GAME_MENU.updateGold();\n        }\n    }\n\n    private onShareBtnClick(): void {\n        const Utils3 = cc.js.getClassByName(\"Utils3\");\n        Utils3.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        \n        const ShareSdk = cc.js.getClassByName(\"ShareSdk\");\n        const self = this;\n        \n        ShareSdk.shareAppMessage({\n            title: \"炸弹，金币每天领，快来领取吧\",\n            imageUrl: window.tempFileURL[0],\n            success: function() {\n                //self.m_n_sharenode.active = true;\n            },\n            fail: function() {},\n            complete: function() {}\n        });\n    }\n}"]}