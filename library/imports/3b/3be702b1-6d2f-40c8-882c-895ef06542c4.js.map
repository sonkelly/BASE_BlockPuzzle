{"version":3,"sources":["assets/Scripts/fkScore.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport Common from \"./Common\";\nimport LvData_JieMi from \"./LvData_JieMi\";\nimport { MODE, GameMode, Property } from \"./Property\";\nimport ResourceUtil from \"./resourceUtil\";\nimport AudioManager from \"./AudioManager\";\nimport LvData_ChuangGuan from \"./LvData_ChuangGuan\";\nimport { GameData } from \"./GameData\";\n@ccclass\nexport default class fkScore extends cc.Component {\n    @property\n    private _gameScore: number = 0;\n    @property\n    private _showScore: number = 0;\n    @property\n    private _showBestScore: number = 0;\n    @property\n    private _curScore: number = 0;\n    @property\n    private changeS: number = 1;\n    @property\n    private _nowTaskNum: number = 0;\n    \n    @property(cc.Node)\n    moveParent: cc.Node = null;\n    @property(cc.Label)\n    scoreLab: cc.Label = null;\n    @property(cc.Label)\n    bestScoreLab: cc.Label = null;\n    @property(dragonBones.ArmatureDisplay)\n    skeHeart: dragonBones.ArmatureDisplay = null;\n    @property(cc.Sprite)\n    taskSprite: cc.Sprite = null;\n    @property(cc.Label)\n    nowTaskLabel: cc.Label = null;\n    @property(cc.Label)\n    taskLabel: cc.Label = null;\n    @property(cc.Label)\n    levelLabel: cc.Label = null;\n\n    private isEject: boolean = false;\n\n    onLoad() {\n        this.isEject = false;\n        this.readBestScore();\n        this._gameScore = 0;\n        this._showScore = this._gameScore;\n        \n        if (this.skeHeart) {\n            this.skeHeart.removeEventListener(dragonBones.EventObject.COMPLETE, this.playSkeComplete, this);\n            this.skeHeart.addEventListener(dragonBones.EventObject.COMPLETE, this.playSkeComplete, this);\n        }\n        \n        this.setTaskNumber();\n        this.setLevelNum();\n    }\n\n    private readBestScore() {\n        this._showBestScore = GameData.getBestScore(GameMode);\n        this.bestScoreLab.string = this._showBestScore.toString();\n    }\n\n    private setLevelNum() {\n        if (GameMode == MODE.JIEMI || GameMode == MODE.CHUANGGUAN) {\n            this.levelLabel.string = \"Current Level \" + GameData.level[GameMode];\n        }\n    }\n\n    private setTaskNumber() {\n        if (GameMode == MODE.JIEMI) {\n            this.taskLabel.string = LvData_JieMi.JM_LEVEL_DATA[GameData.level[GameMode]].board.length.toString();\n            ResourceUtil.instance.setSpriteFrame(\"kuai/k\" + LvData_JieMi.JM_LEVEL_DATA[GameData.level[GameMode]].color, this.taskSprite);\n        } else {\n            if (GameMode != MODE.CHUANGGUAN) return;\n            this.taskLabel.string = LvData_ChuangGuan.CG_LEVEL_DATA[GameData.level[GameMode]].board.length.toString();\n        }\n        this.nowTaskLabel.string = this._nowTaskNum.toString();\n    }\n\n    private playSke() {\n        this.skeHeart.node.active = true;\n        this.skeHeart.playAnimation(\"newAnimation\", 1);\n    }\n\n    private playSkeComplete() {\n        this.skeHeart.playAnimation(\"xunhuan\", 1);\n    }\n\n    private hideHeatBeat() {\n        this.skeHeart.node.active = false;\n    }\n\n    setBoardScore(score: number, type: number) {\n        let diff = score - this._curScore;\n        \n        if (diff > Property.CHANGE_SCORE) {\n            this.changeS = Math.floor(Property.CHANGE_TIME / (2 / diff));\n            this.changeS = this.changeS < 1 ? 1 : this.changeS;\n        } else {\n            this.changeS = 1;\n        }\n        \n        if (type == 1) {\n            this.changeS = diff;\n        }\n        \n        this._curScore = score;\n        \n        if (GameMode == MODE.JINGDIAN) {\n            GameData.curScore = score;\n        }\n        \n        if (GameData.isGetBestScore == 0 && GameData.getBestScore(GameMode) != 0) {\n            let bestScore = GameData.getBestScore(GameMode);\n            if (this._showBestScore > bestScore) {\n                GameData.isGetBestScore = 1;\n                Common.instance.showNewScore();\n            }\n        }\n    }\n\n    update() {\n        this.updateScore();\n        if (this._curScore > this._showBestScore) {\n            this.updateBestScore();\n        }\n    }\n\n    private updateScore() {\n        if (this._curScore > this._gameScore) {\n            this._gameScore += this.changeS;\n            this.scoreLab.string = this._gameScore.toString();\n        } else if (this._gameScore > this._curScore) {\n            this._gameScore = this._curScore;\n            this.scoreLab.string = this._gameScore.toString();\n        }\n    }\n\n    private updateBestScore() {\n        if (this._curScore > this._showBestScore) {\n            this._showBestScore += this.changeS;\n            this.bestScoreLab.string = this._showBestScore.toString();\n        }\n    }\n\n    btnPause() {\n        AudioManager.instance.playClickSound();\n        const self = this;\n        \n        if (this.isEject) {\n            cc.tween(this.moveParent)\n                .call(() => {\n                    cc.find(\"moveParent/btnFlush\", this.node).active = false;\n                    cc.find(\"moveParent/btnHome\", this.node).active = false;\n                })\n                .by(0.6, { position: cc.v2(-220, 0) }, { easing: \"elasticOut\" })\n                .start();\n        } else {\n            cc.tween(this.moveParent)\n                .call(() => {\n                    cc.find(\"moveParent/btnFlush\", this.node).active = true;\n                    cc.find(\"moveParent/btnHome\", this.node).active = true;\n                })\n                .by(0.6, { position: cc.v2(220, 0) }, { easing: \"elasticOut\" })\n                .start();\n        }\n        \n        this.isEject = !this.isEject;\n    }\n\n    btnHome() {\n        AudioManager.instance.playClickSound();\n        Common.instance.setBestScore();\n        Common.instance.toMenu();\n    }\n\n    btnFlush() {\n        GameData.gameDataBind.restartGame();\n    }\n}"]}