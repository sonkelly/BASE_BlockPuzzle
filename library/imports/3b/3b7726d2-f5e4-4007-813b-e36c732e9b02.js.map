{"version":3,"sources":["assets/Scripts/layerBase.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAC5C,uCAAsD;AACtD,yDAAoD;AACpD,+CAA0C;AAC1C,+CAAuD;AACvD,+CAA0C;AAC1C,mCAA8B;AAC9B,uCAAsC;AACtC,iCAA4B;AAG5B;IAAuC,6BAAY;IAAnD;QAAA,qEA0JC;QAvJG,sBAAgB,GAAY,KAAK,CAAC;QAMlC,cAAQ,GAAgC,IAAI,CAAC;QAM7C,WAAK,GAAY,IAAI,CAAC;QAMtB,aAAO,GAAY,IAAI,CAAC;QAMxB,cAAQ,GAAa,IAAI,CAAC;QAM1B,kBAAY,GAAY,IAAI,CAAC;QAErB,aAAO,GAAW,CAAC,CAAC;QACpB,cAAQ,GAAW,CAAC,CAAC;QACrB,eAAS,GAAW,CAAC,CAAC;QACtB,aAAO,GAAW,CAAC,CAAC;;IAoHhC,CAAC;IAlHG,0BAAM,GAAN;QAAA,iBAwBC;QAvBG,mBAAQ,CAAC,KAAK,EAAE,CAAC;QAEjB,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,eAAK,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,EAAE,cAAc,EAAE;gBAC7C,OAAO,eAAK,CAAC,OAAO,CAAC,KAAI,CAAC,QAAQ,EAAE,gBAAgB,CAAC,CAAC;YAC1D,CAAC,CAAC,CAAC;SACN;QAED,IAAI,IAAI,CAAC,KAAK,EAAE;YACZ,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC;iBACf,aAAa,CACV,EAAE,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,KAAK,EAAE,CAAC,GAAG,EAAE,CAAC,CACpC;iBACA,KAAK,EAAE,CAAC;SAChB;QAED,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,CAAC;SAC1B;QAED,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,IAAI,CAAC,YAAY,GAAG,mBAAQ,CAAC,YAAY,CAAC,mBAAQ,CAAC,CAAC;SACvD;IACL,CAAC;IAED,yBAAK,GAAL;QACI,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QACjB,IAAI,CAAC,QAAQ,GAAG,mBAAQ,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC;QAExD,IAAI,IAAI,CAAC,gBAAgB,EAAE;YACvB,IAAI,CAAC,QAAQ,GAAG,mBAAQ,CAAC,YAAY,CAAC,mBAAQ,CAAC,CAAC;SACnD;QAED,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;QACnB,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QAEjB,IAAI,IAAI,CAAC,QAAQ,GAAG,mBAAQ,CAAC,YAAY,EAAE;YACvC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,mBAAQ,CAAC,WAAW,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;SACtD;IACL,CAAC;IAED,0BAAM,GAAN,UAAO,EAAU;QACb,IAAI,CAAC,WAAW,EAAE,CAAC;IACvB,CAAC;IAEO,+BAAW,GAAnB;QACI,IAAI,IAAI,CAAC,OAAO;YAAE,OAAO;QAEzB,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,OAAO,CAAC;QAC/B,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAO,CAAC,QAAQ,CAAC,CAAC;QAClD,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC;QAEjD,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjC,IAAI,CAAC,cAAc,EAAE,CAAC;SACzB;IACL,CAAC;IAEO,kCAAc,GAAtB;QACI,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QAEjB,IAAI,IAAI,CAAC,KAAK,EAAE;YACZ,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE,CAAC;SAC/B;QAED,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;QAChD,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAO,CAAC,SAAS,CAAC,CAAC;QAEnD,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC;iBACjB,EAAE,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,EAAE,MAAM,EAAE,YAAY,EAAE,CAAC;iBAC/C,KAAK,EAAE,CAAC;SAChB;IACL,CAAC;IAED,kCAAc,GAAd;QACI,sBAAY,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC;QACvC,sBAAY,CAAC,QAAQ,CAAC,sBAAsB,EAAE,CAAC;QAE/C,mBAAQ,CAAC,SAAS,GAAG,EAAE,CAAC;QACxB,mBAAQ,CAAC,QAAQ,GAAG,CAAC,CAAC;QAEtB,IAAI,mBAAQ,IAAI,eAAI,CAAC,KAAK,EAAE;YACxB,IAAI,mBAAQ,CAAC,UAAU,IAAI,CAAC,EAAE;gBAC1B,mBAAQ,CAAC,UAAU,GAAG,CAAC,CAAC;gBACxB,mBAAQ,CAAC,QAAQ,EAAE,CAAC;aACvB;YACD,gBAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;SAC5B;aAAM;YACH,gBAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;SAC5B;IACL,CAAC;IAED,gCAAY,GAAZ;QACI,sBAAY,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC;IACxC,CAAC;IAED,+BAAW,GAAX;QACI,sBAAY,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC;QACvC,sBAAY,CAAC,QAAQ,CAAC,sBAAsB,EAAE,CAAC;QAC/C,mBAAQ,CAAC,KAAK,CAAC,mBAAQ,CAAC,EAAE,CAAC;QAE3B,IAAI,mBAAQ,IAAI,eAAI,CAAC,KAAK,IAAI,mBAAQ,CAAC,KAAK,CAAC,mBAAQ,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,sBAAY,CAAC,aAAa,CAAC,CAAC,MAAM,EAAE;YACrG,mBAAQ,CAAC,KAAK,CAAC,mBAAQ,CAAC,GAAG,CAAC,CAAC;SAChC;QAED,IAAI,mBAAQ,IAAI,eAAI,CAAC,UAAU,IAAI,mBAAQ,CAAC,KAAK,CAAC,mBAAQ,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,2BAAiB,CAAC,aAAa,CAAC,CAAC,MAAM,EAAE;YAC/G,mBAAQ,CAAC,KAAK,CAAC,mBAAQ,CAAC,GAAG,CAAC,CAAC;SAChC;QAED,mBAAQ,CAAC,QAAQ,EAAE,CAAC;QACpB,gBAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;IAC7B,CAAC;IAtJD;QADC,QAAQ;uDACyB;IAMlC;QAJC,QAAQ,CAAC;YACN,IAAI,EAAE,WAAW,CAAC,eAAe;YACjC,OAAO,EAAE,MAAM;SAClB,CAAC;+CAC2C;IAM7C;QAJC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,IAAI;YACb,OAAO,EAAE,QAAQ;SACpB,CAAC;4CACoB;IAMtB;QAJC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,IAAI;YACb,OAAO,EAAE,OAAO;SACnB,CAAC;8CACsB;IAMxB;QAJC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,KAAK;YACd,OAAO,EAAE,MAAM;SAClB,CAAC;+CACwB;IAM1B;QAJC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,IAAI;YACb,OAAO,EAAE,OAAO;SACnB,CAAC;mDAC2B;IAjCZ,SAAS;QAD7B,OAAO;OACa,SAAS,CA0J7B;IAAD,gBAAC;CA1JD,AA0JC,CA1JsC,EAAE,CAAC,SAAS,GA0JlD;kBA1JoB,SAAS","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport { MODE, GameMode, Property } from \"./Property\";\nimport LvData_ChuangGuan from \"./LvData_ChuangGuan\";\nimport LvData_JieMi from \"./LvData_JieMi\";\nimport AudioManager, { AudioID } from \"./AudioManager\";\nimport EventManager from \"./EventManager\";\nimport Common from \"./Common\";\nimport { GameData } from \"./GameData\";\nimport Utils from \"./Utils\";\n\n@ccclass\nexport default class layerBase extends cc.Component {\n\n    @property\n    isBestScoreLayer: boolean = false;\n\n    @property({\n        type: dragonBones.ArmatureDisplay,\n        tooltip: \"皇冠龙骨\"\n    })\n    crownAni: dragonBones.ArmatureDisplay = null;\n\n    @property({\n        type: cc.Node,\n        tooltip: \"分数背后的光\"\n    })\n    guang: cc.Node = null;\n\n    @property({\n        type: cc.Node,\n        tooltip: \"下一关按钮\"\n    })\n    btnNext: cc.Node = null;\n\n    @property({\n        type: cc.Label,\n        tooltip: \"当前得分\"\n    })\n    scoreLab: cc.Label = null;\n\n    @property({\n        type: cc.Node,\n        tooltip: \"当前最高分\"\n    })\n    bestScoreLab: cc.Node = null;\n\n    private isPause: number = 0;\n    private curScore: number = 0;\n    private gameScore: number = 0;\n    private changeS: number = 1;\n\n    onLoad() {\n        GameData.pause();\n        \n        if (this.crownAni) {\n            Utils.playAniCall(this.crownAni, \"newAnimation\", () => {\n                return Utils.playAni(this.crownAni, \"newAnimation_1\");\n            });\n        }\n        \n        if (this.guang) {\n            cc.tween(this.guang)\n                .repeatForever(\n                    cc.tween().by(3, { angle: -360 })\n                )\n                .start();\n        }\n        \n        if (this.btnNext) {\n            this.btnNext.scale = 0;\n        }\n        \n        if (this.bestScoreLab) {\n            this.bestScoreLab = GameData.getBestScore(GameMode);\n        }\n    }\n\n    start() {\n        this.isPause = 0;\n        this.curScore = GameData.gameDataBind.fkScore._curScore;\n        \n        if (this.isBestScoreLayer) {\n            this.curScore = GameData.getBestScore(GameMode);\n        }\n        \n        this.gameScore = 0;\n        this.changeS = 1;\n        \n        if (this.curScore > Property.CHANGE_SCORE) {\n            this.changeS = Math.floor(Property.CHANGE_TIME / (2 / this.curScore));\n            this.changeS = this.changeS < 1 ? 1 : this.changeS;\n        }\n    }\n\n    update(dt: number) {\n        this.updateScore();\n    }\n\n    private updateScore() {\n        if (this.isPause) return;\n        \n        this.gameScore += this.changeS;\n        AudioManager.instance.playSound(AudioID.EndScore);\n        this.scoreLab.string = this.gameScore.toString();\n        \n        if (this.gameScore >= this.curScore) {\n            this.scoreAddFinish();\n        }\n    }\n\n    private scoreAddFinish() {\n        this.isPause = 1;\n        \n        if (this.guang) {\n            this.guang.stopAllActions();\n        }\n        \n        this.scoreLab.string = this.curScore.toString();\n        AudioManager.instance.playSound(AudioID.EndButton);\n        \n        if (this.btnNext) {\n            cc.tween(this.btnNext)\n                .to(0.6, { scale: 1 }, { easing: \"elasticOut\" })\n                .start();\n        }\n    }\n\n    onClickRestart() {\n        AudioManager.instance.playClickSound();\n        EventManager.instance.EventInterstitialVideo();\n        \n        GameData.blockData = [];\n        GameData.curScore = 0;\n        \n        if (GameMode == MODE.TEACH) {\n            if (GameData.teachingXS == 3) {\n                GameData.teachingXS = 0;\n                GameData.saveData();\n            }\n            Common.instance.toGame();\n        } else {\n            Common.instance.toGame();\n        }\n    }\n\n    onClickShare() {\n        EventManager.instance.shareRecord();\n    }\n\n    onClickNext() {\n        AudioManager.instance.playClickSound();\n        EventManager.instance.EventInterstitialVideo();\n        GameData.level[GameMode]++;\n        \n        if (GameMode == MODE.JIEMI && GameData.level[GameMode] > Object.keys(LvData_JieMi.JM_LEVEL_DATA).length) {\n            GameData.level[GameMode] = 1;\n        }\n        \n        if (GameMode == MODE.CHUANGGUAN && GameData.level[GameMode] > Object.keys(LvData_ChuangGuan.CG_LEVEL_DATA).length) {\n            GameData.level[GameMode] = 1;\n        }\n        \n        GameData.saveData();\n        Common.instance.toGame();\n    }\n}"]}