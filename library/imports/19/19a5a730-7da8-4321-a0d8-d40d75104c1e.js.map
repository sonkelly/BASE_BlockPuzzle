{"version":3,"sources":["assets/Scripts/playEffect.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ExtendScript from \"./ExtendScript\";\nimport Utils from \"./Utils\";\n\nconst { ccclass, property } = cc._decorator;\n\nconst POP_NAMES: Record<number, string> = {\n    2: \"popFlatter1\",\n    3: \"popFlatter2\",\n    4: \"popFlatter3\",\n    5: \"popFlatter4\",\n    6: \"popFlatter5\",\n};\n\ninterface PlayEliminateData {\n    pos: cc.Vec2;\n    disLine: number;\n    colorType: string;\n}\n\ninterface PlayComboData {\n    pos: cc.Vec2;\n    pos2: cc.Vec2;\n    comTimes: number;\n    score: number;\n}\n\n@ccclass\nexport default class PlayEffect extends ExtendScript {\n    @property(cc.Prefab)\n    popFlatter: cc.Prefab = null;\n\n    @property(cc.Prefab)\n    popCombo: cc.Prefab = null;\n\n    @property(cc.Prefab)\n    popComboScore: cc.Prefab = null;\n\n    @property(cc.Prefab)\n    popEliminateScore: cc.Prefab = null;\n\n    playEliminate(data: PlayEliminateData) {\n        const node = cc.instantiate(this.popEliminateScore);\n        const parent = this.node;\n\n        const PopEliminate = cc.Class({\n            extends: cc.Component,\n            initial(e: PlayEliminateData) {\n                this.node.parent = parent;\n                this.node.setPosition(e.pos);\n\n                const lineNode = this.node.children[e.disLine - 1];\n                if (!lineNode) return;\n                lineNode.active = true;\n\n                const loadDigit = (index: number) => {\n                    const digitNode = lineNode.children[index];\n                    cc.resources.load(\n                        `image/number/${e.colorType}_${digitNode.name}`,\n                        cc.SpriteFrame,\n                        (err: Error, spriteFrame: cc.SpriteFrame) => {\n                            if (err) {\n                                console.log(err);\n                                return;\n                            }\n                            digitNode.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n                        }\n                    );\n                };\n\n                for (let i = 0; i < lineNode.children.length; i++) {\n                    loadDigit(i);\n                }\n\n                cc.tween(this.node)\n                    .to(0.3, { scale: 1 })\n                    .delay(0.5)\n                    .call(() => this.clean())\n                    .start();\n            },\n            clean() {\n                this.node.destroy();\n            },\n        });\n\n        node.addComponent(PopEliminate);\n        (node.getComponent(PopEliminate) as any).initial(data);\n    }\n\n    playCombo(data: PlayComboData) {\n        const comboNode = cc.instantiate(this.popCombo);\n        comboNode.parent = this.node;\n        comboNode.position = data.pos;\n\n        // Giới hạn vị trí X\n        comboNode.x = Math.max(-140, Math.min(150, comboNode.x));\n\n        comboNode.getChildByName(\"combo1\").active = data.comTimes < 2;\n        comboNode.getChildByName(\"combo\").active = data.comTimes > 1;\n        comboNode.getChildByName(\"combo_ske\").scale = data.comTimes > 1 ? 1 : 0;\n        comboNode.getChildByName(\"Label_combo\").active = data.comTimes > 1;\n\n        const comboLabel = comboNode\n            .getChildByName(\"Label_combo\")\n            .getComponent(cc.Label);\n        comboLabel.string = data.comTimes.toString();\n\n        this.scheduleOnce(() => {\n            comboNode.destroy();\n            this.playComboScore(data.score, data.pos2);\n        }, 1.67);\n    }\n\n    playComboScore(score: number, pos: cc.Vec2) {\n        const scoreNode = cc.instantiate(this.popComboScore);\n        scoreNode.parent = this.node;\n        scoreNode.position = pos;\n\n        const label = scoreNode\n            .getChildByName(\"Label_score\")\n            .getComponent(cc.Label);\n        label.string = `+${score}`;\n\n        (Utils as any).nodePlayAnimationCall(scoreNode, null, () => {\n            cc.tween(scoreNode)\n                .to(0.2, { x: 0, y: 410 })\n                .call(() => scoreNode.destroy())\n                .start();\n        });\n    }\n\n    playMultiRow(row: number, pos: cc.Vec2) {\n        if (row < 2) return;\n\n        const flatterNode = cc.instantiate(this.popFlatter);\n        flatterNode.parent = this.node;\n        flatterNode.position = pos;\n\n        (Utils as any).nodePlayAnimationCall(flatterNode, POP_NAMES[row], () => {\n            flatterNode.destroy();\n        });\n    }\n}\n"]}