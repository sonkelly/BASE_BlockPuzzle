{"version":3,"sources":["assets/Scripts/Wave_VH.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAC5C,oFAA+E;AAC/E,wEAAmE;AACnE,wEAAmE;AAEnE;IAAqC,2BAAY;IAAjD;QAAA,qEAmFC;QAlFW,cAAQ,GAAiB,IAAI,CAAC;QAC9B,YAAM,GAAW,CAAC,CAAC;QACnB,aAAO,GAAW,CAAC,CAAC;QACpB,gBAAU,GAAQ,IAAI,CAAC;QACvB,eAAS,GAAQ,IAAI,CAAC;QACtB,YAAM,GAAQ,IAAI,CAAC;;IA6E/B,CAAC;IA3EG,wBAAM,GAAN;QACI,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;QACjB,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QACjB,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IAEO,sBAAI,GAAZ;QACI,IAAI,CAAC,QAAQ,GAAG,IAAI,EAAE,CAAC,SAAS,EAAE,CAAC;QAEnC,IAAI,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YACjB,EAAE,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;YAC/B,IAAM,UAAU,GAAG,qCAA2B,CAAC;YAC/C,IAAM,UAAU,GAAG,+BAAqB,CAAC;YACzC,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;YACrD,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YACrB,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC;SAClC;aAAM;YACH,IAAM,UAAU,GAAG,+BAAqB,CAAC;YACzC,IAAM,UAAU,GAAG,+BAAqB,CAAC;YACzC,IAAI,CAAC,QAAQ,CAAC,6BAA6B,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;YACpE,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,uBAAuB,EAAE,EAAE,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC;YAC9F,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,oBAAoB,EAAE,EAAE,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC;YACxF,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,wBAAwB,EAAE,EAAE,CAAC,KAAK,CAAC,wBAAwB,CAAC,CAAC;YACjG,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YACrB,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC;SAClC;QAED,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,yBAAyB,CAAC,QAAQ,CAAC,CAAC;QACpE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,yBAAyB,CAAC,OAAO,CAAC,CAAC;QAClE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,yBAAyB,CAAC,OAAO,CAAC,CAAC;QAE/D,IAAI,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YACjB,IAAM,YAAY,GAAG,EAAE,CAAC,cAAc,CAAC,wBAAwB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC/E,YAAY,CAAC,eAAe,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;SAC7D;aAAM;YACH,IAAI,CAAC,QAAQ,CAAC,wBAAwB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;SACvE;QAED,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;IACtD,CAAC;IAEO,4BAAU,GAAlB,UAAmB,IAAS,EAAE,OAAqB;QAC/C,IAAI,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YACjB,IAAM,YAAY,GAAG,EAAE,CAAC,cAAc,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAC;YACzE,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;SACxC;aAAM;YACH,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;SAClC;QAED,IAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC/B,IAAI,QAAQ,EAAE;YACV,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACtC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;aACzC;SACJ;IACL,CAAC;IAED,wBAAM,GAAN;QACI,IAAI,CAAC,IAAI,CAAC,QAAQ;YAAE,OAAO;QAE3B,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC;QACpB,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC;QAErB,IAAI,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YACjB,IAAM,YAAY,GAAG,EAAE,CAAC,cAAc,CAAC,wBAAwB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC/E,YAAY,CAAC,eAAe,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;SAC/D;aAAM;YACH,IAAI,CAAC,QAAQ,CAAC,wBAAwB,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;YACtE,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC;SAClC;QAED,IAAI,IAAI,CAAC,OAAO,GAAG,IAAI,EAAE;YACrB,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;SACpB;IACL,CAAC;IAlFgB,OAAO;QAD3B,OAAO;OACa,OAAO,CAmF3B;IAAD,cAAC;CAnFD,AAmFC,CAnFoC,EAAE,CAAC,SAAS,GAmFhD;kBAnFoB,OAAO","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport ccShader_Default_Vert_noMVP from \"./shader/ccShader_Default_Vert_noMVP\";\nimport ccShader_Wave_VH_Frag from \"./shader/ccShader_Wave_VH_Frag\";\nimport ccShader_Default_Vert from \"./shader/ccShader_Default_Vert\";\n@ccclass\nexport default class Wave_VH extends cc.Component {\n    private _program: cc.GLProgram = null;\n    private _angle: number = 0;\n    private _motion: number = 0;\n    private _uniMotion: any = null;\n    private _uniAngle: any = null;\n    private _mouse: any = null;\n\n    onLoad() {\n        this._angle = 15;\n        this._motion = 0;\n        this._use();\n    }\n\n    private _use() {\n        this._program = new cc.GLProgram();\n        \n        if (cc.sys.isNative) {\n            cc.log(\"use native GLProgram\");\n            const vertShader = ccShader_Default_Vert_noMVP;\n            const fragShader = ccShader_Wave_VH_Frag;\n            this._program.initWithString(vertShader, fragShader);\n            this._program.link();\n            this._program.updateUniforms();\n        } else {\n            const vertShader = ccShader_Default_Vert;\n            const fragShader = ccShader_Wave_VH_Frag;\n            this._program.initWithVertexShaderByteArray(vertShader, fragShader);\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\n            this._program.link();\n            this._program.updateUniforms();\n        }\n\n        this._uniMotion = this._program.getUniformLocationForName(\"motion\");\n        this._uniAngle = this._program.getUniformLocationForName(\"angle\");\n        this._mouse = this._program.getUniformLocationForName(\"mouse\");\n\n        if (cc.sys.isNative) {\n            const programState = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\n            programState.setUniformFloat(this._uniAngle, this._angle);\n        } else {\n            this._program.setUniformLocationWith1f(this._uniAngle, this._angle);\n        }\n\n        this.setProgram(this.node._sgNode, this._program);\n    }\n\n    private setProgram(node: any, program: cc.GLProgram) {\n        if (cc.sys.isNative) {\n            const programState = cc.GLProgramState.getOrCreateWithGLProgram(program);\n            node.setGLProgramState(programState);\n        } else {\n            node.setShaderProgram(program);\n        }\n\n        const children = node.children;\n        if (children) {\n            for (let i = 0; i < children.length; i++) {\n                this.setProgram(children[i], program);\n            }\n        }\n    }\n\n    update() {\n        if (!this._program) return;\n\n        this._program.use();\n        this._motion += 0.02;\n\n        if (cc.sys.isNative) {\n            const programState = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\n            programState.setUniformFloat(this._uniMotion, this._motion);\n        } else {\n            this._program.setUniformLocationWith1f(this._uniMotion, this._motion);\n            this._program.updateUniforms();\n        }\n\n        if (this._motion > 1e20) {\n            this._motion = 0;\n        }\n    }\n}"]}