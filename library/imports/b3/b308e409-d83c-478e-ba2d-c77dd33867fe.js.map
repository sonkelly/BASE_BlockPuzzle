{"version":3,"sources":["assets/Scripts/kuaiManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport { MODE, GameMode, RESUME_BLOCK_ARR, TEACHING, BLOCK_WEIGHT_SCORE, BlockWeight, Property } from \"./Property\";\nimport AudioManager, {AudioID} from \"./AudioManager\";\nimport clientEvent from \"./clientEvent\";\nimport WeightRandom from \"./WeightRandom\";\nimport Common from \"./Common\";\nimport LvData_JieMi from \"./LvData_JieMi\";\nimport _ from \"./lodash\";\nimport ExtendScript from \"./ExtendScript\";\nimport { GameData } from \"./GameData\";\n\n@ccclass\nexport default class KuaiManager extends cc.Component {\n    @property(cc.Node)\n    notPlace: cc.Node = null;\n\n    @property(cc.Label)\n    labshape: cc.Label = null;\n\n    @property({\n        type: [cc.Node],\n        tooltip: \"放置块的父节点\"\n    })\n    fkBornPos: cc.Node[] = [];\n\n    @property({\n        type: [cc.Prefab],\n        tooltip: \"方块预制体\"\n    })\n    fkPrefab: cc.Prefab[] = [];\n\n    private surplusKuaiM: number = 3;\n    private blockIndex: number = 0;\n    private blockNum: number = 0;\n    private btnRefreshBlock: cc.Node = null;\n\n    onLoad() {\n        this.surplusKuaiM = 3;\n        this.sendKuaiM();\n        this.initialMode();\n        clientEvent.on(\"blockPut\", this.checkbloackPut, this);\n        clientEvent.on(\"reviveEvent\", this.reviveEvent, this);\n        clientEvent.on(\"useProp\", this.usPropFinish, this);\n    }\n\n    onDestroy() {\n        clientEvent.off(\"blockPut\", this.checkbloackPut, this);\n        clientEvent.off(\"reviveEvent\", this.reviveEvent, this);\n        clientEvent.off(\"useProp\", this.usPropFinish, this);\n    }\n\n    private initialMode() {\n        this.btnRefreshBlock = this.node.getChildByName(\"btnRefreshBlock\");\n        this.btnRefreshBlock.active = false;\n        if (GameMode == MODE.JIEMI) {\n            this.setBlockNum(LvData_JieMi.JM_LEVEL_DATA[GameData.level[GameMode]].block.length);\n        }\n    }\n\n    private checkbloackPut() {\n        if (GameMode == MODE.JINGDIAN) {\n            if (GameData.teaching < 2) {\n                GameData.teaching++;\n                GameData.saveData();\n                this.scheduleOnce(() => {\n                    Common.instance.toGame();\n                }, 1.6);\n                return;\n            }\n            if (GameData.teaching == 2) {\n                GameData.teaching = 3;\n                GameData.saveData();\n            }\n        } else if (GameMode == MODE.TEACH) {\n            if (GameData.teachingXS < 2) {\n                GameData.teachingXS++;\n                GameData.saveData();\n                this.scheduleOnce(() => {\n                    Common.instance.toGame();\n                }, 1.6);\n                return;\n            }\n            if (GameData.teachingXS == 2) {\n                GameData.teachingXS = 3;\n                GameData.saveData();\n            }\n        }\n\n        if (GameMode == MODE.JIUJIU2) {\n            const score = GameData.gameDataBind.fkScore._curScore;\n            let weightArray: number[];\n            \n            if (score < BLOCK_WEIGHT_SCORE[0]) {\n                weightArray = BlockWeight[GameMode][0];\n            } else if (score < BLOCK_WEIGHT_SCORE[1]) {\n                weightArray = BlockWeight[GameMode][1];\n            } else {\n                weightArray = BlockWeight[GameMode][2];\n            }\n\n            const random = new WeightRandom();\n            for (let i = 0; i <= weightArray.length; i++) {\n                random.weightAdd(i, weightArray[i]);\n            }\n            \n            const nextIndex = random.weightNext();\n            this.newNone(GameData.blockIndex, nextIndex);\n            random.weightDeleteAll(nextIndex);\n        } else {\n            this.surplusKuaiM--;\n            if (this.surplusKuaiM <= 0) {\n                this.surplusKuaiM = 3;\n                this.sendKuaiM();\n            }\n        }\n        \n        this.checkIsLose();\n    }\n\n    private sendKuaiM() {\n        if (GameMode == MODE.JINGDIAN && GameData.teaching < 3) {\n            this.surplusKuaiM = 1;\n            this.newNone(1, TEACHING.BLOCK[GameData.teaching], TEACHING.BLOCK_COLOR[GameData.teaching]);\n        } else if (GameMode == MODE.TEACH && GameData.teachingXS < 3) {\n            this.surplusKuaiM = 1;\n            this.newNone(1, TEACHING.BLOCK[GameData.teachingXS], TEACHING.BLOCK_COLOR[GameData.teachingXS]);\n        } else if (GameMode == MODE.JIEMI) {\n            if (!this.blockIndex) {\n                this.blockIndex = 0;\n            }\n            \n            for (let i = 0; i < 3; i++) {\n                if (this.blockIndex >= LvData_JieMi.JM_LEVEL_DATA[GameData.level[GameMode]].block.length) {\n                    return;\n                }\n                \n                const colors = [0, 1, 2, 3, 4, 5, 6];\n                colors.splice(LvData_JieMi.JM_LEVEL_DATA[GameData.level[GameMode]].color, 1);\n                const colorIndex = _.random(0, colors.length - 1);\n                \n                this.newNone(i, LvData_JieMi.JM_LEVEL_DATA[GameData.level[GameMode]].block[this.blockIndex], colors[colorIndex]);\n                this.blockIndex++;\n            }\n        } else {\n            const score = GameData.gameDataBind.fkScore._curScore;\n            let weightArray: number[];\n            \n            if (score < BLOCK_WEIGHT_SCORE[0]) {\n                weightArray = BlockWeight[GameMode][0];\n            } else if (score < BLOCK_WEIGHT_SCORE[1]) {\n                weightArray = BlockWeight[GameMode][1];\n            } else {\n                weightArray = BlockWeight[GameMode][2];\n            }\n\n            const random = new WeightRandom();\n            for (let i = 0; i <= weightArray.length; i++) {\n                random.weightAdd(i, weightArray[i]);\n            }\n            \n            for (let i = 0; i < 3; i++) {\n                const nextIndex = random.weightNext();\n                this.newNone(i, nextIndex);\n                random.weightDeleteAll(nextIndex);\n            }\n        }\n        \n        this.checkIsLose();\n    }\n\n    private newNone(index: number, type: number, color?: number) {\n        \n        const node = cc.instantiate(this.fkPrefab[type]);\n        node.setPosition(0, 0);\n        node.parent = this.fkBornPos[index];\n        node.getComponent(ExtendScript).init(color != null ? color : _.random(0, 6), type, true, index);\n    }\n\n    private usPropFinish() {\n        this.checkIsLose();\n    }\n\n    private checkIsLose() {\n        if (GameMode == MODE.JIEMI && GameData.isWin) {\n            return;\n        }\n\n        let loseCount = 0;\n        let totalCount = 0;\n\n        for (let i = 0; i < 3; i++) {\n            const child = this.fkBornPos[i].children[0];\n            if (child) {\n                totalCount++;\n                const script = child.getComponent(ExtendScript); // 假设脚本名为BlockScript\n                if (script) {\n                    if (script.checkIsLose()) {\n                        loseCount++;\n                        script.setGrayKuai();\n                    } else {\n                        script.recoveryKuai();\n                    }\n                }\n            }\n        }\n\n        if (loseCount > Property.PUSH_NOT_PUT) {\n            this.showRefreshBlock();\n        }\n\n        if (loseCount == totalCount) {\n            console.log(\"lose!!!!!!!!!!!!\" + loseCount);\n            AudioManager.instance.playSound(AudioID.Lost);\n            GameData.isFail = true;\n            GameData.gameDataBind.boardFrame.gameLose();\n\n            if (GameMode == MODE.JIEMI) {\n                const outNum = this.notPlace.getChildByName(\"sp_outNum\");\n                const noPut = this.notPlace.getChildByName(\"sp_noPut\");\n                outNum.active = this.getBlockNum() <= 0;\n                noPut.active = this.getBlockNum() > 0;\n                \n                cc.tween(this.notPlace)\n                    .set({ opacity: 255 })\n                    .delay(0.25)\n                    .to(0.36, { opacity: 0 })\n                    .to(0.45, { opacity: 255 })\n                    .start();\n            } else {\n                cc.tween(this.notPlace)\n                    .set({ opacity: 255 })\n                    .delay(0.25)\n                    .to(0.36, { opacity: 0 })\n                    .to(0.45, { opacity: 255 })\n                    .start();\n            }\n        }\n    }\n\n    private reviveEvent() {\n        this.notPlace.opacity = 0;\n        this.sendKuaiMDefault(RESUME_BLOCK_ARR);\n    }\n\n    private setBlockNum(num: number) {\n        this.blockNum = num;\n        this.labshape.string = this.blockNum + \"/\" + LvData_JieMi.JM_LEVEL_DATA[GameData.level[GameMode]].block.length;\n    }\n\n    private getBlockNum(): number {\n        return this.blockNum;\n    }\n\n    private cleanBlockBoard() {\n        for (let i = 0; i < this.fkBornPos.length; i++) {\n            const child = this.fkBornPos[i].children[0];\n            if (child) {\n                const script = child.getComponent(ExtendScript); // 假设脚本名为BlockScript\n                if (script) {\n                    script.clean();\n                }\n            }\n        }\n        this.surplusKuaiM = 3;\n    }\n\n    private onClickRefreshBlock() {\n        this.showRefreshBlock(true);\n    }\n\n    private showRefreshBlock(isClick: boolean = false) {\n        Common.instance.pushChangeBlock(isClick, () => {\n            const blockArr = [0, _.random(1, 9), 0];\n            this.sendKuaiMDefault(blockArr);\n            this.btnRefreshBlock.active = false;\n        }, () => {\n            this.btnRefreshBlock.active = true;\n        });\n    }\n\n    private sendKuaiMDefault(blockArr: number[]) {\n        this.cleanBlockBoard();\n        for (let i = 0; i < blockArr.length; i++) {\n            this.newNone(i, blockArr[i]);\n        }\n    }\n\n    update(dt: number) {\n        if (GameData.isPause) return;\n        \n        GameData.pushChange_Time -= dt;\n        if (GameData.pushChange_Time < 0 && GameData.isTouch == 0) {\n            this.showRefreshBlock();\n        }\n    }\n}"]}